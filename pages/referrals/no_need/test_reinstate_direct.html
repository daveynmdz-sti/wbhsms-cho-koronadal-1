<!DOCTYPE html>
<html>
<head>
    <title>Test Reinstate Function</title>
</head>
<body>
    <h1>Direct Reinstate Test</h1>
    
    <p>This page tests the reinstate function directly with a known cancelled referral ID.</p>
    
    <div>
        <label>Referral ID to test:</label>
        <input type="number" id="testReferralId" value="3" min="1">
        <button onclick="testReinstate()">Test Reinstate</button>
    </div>
    
    <div id="results" style="margin-top: 20px; padding: 10px; background: #f0f0f0; border: 1px solid #ccc;">
        <h3>Results:</h3>
        <div id="log"></div>
    </div>
    
    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>';
        }
        
        function testReinstate() {
            const referralId = document.getElementById('testReferralId').value;
            
            if (!referralId) {
                log('‚ùå Please enter a referral ID');
                return;
            }
            
            log('üöÄ Starting reinstate test for referral ID: ' + referralId);
            
            const formData = new FormData();
            formData.append('referral_id', referralId);
            
            log('üì§ Sending AJAX request to reinstate_referral.php...');
            
            fetch('pages/referrals/reinstate_referral.php', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                log('üì• Response received with status: ' + response.status);
                return response.text();
            })
            .then(text => {
                log('üìÑ Raw response: ' + text);
                
                try {
                    const data = JSON.parse(text);
                    log('‚úÖ Parsed JSON successfully');
                    
                    if (data.success) {
                        log('üéâ SUCCESS: ' + data.message);
                        if (data.data) {
                            log('üìä Data: ' + JSON.stringify(data.data));
                        }
                        
                        // Now check if the database was actually updated
                        checkDatabaseStatus(referralId);
                    } else {
                        log('‚ùå ERROR: ' + data.message);
                    }
                } catch (e) {
                    log('üí• JSON Parse Error: ' + e.message);
                }
            })
            .catch(error => {
                log('üî• Fetch Error: ' + error.message);
            });
        }
        
        function checkDatabaseStatus(referralId) {
            log('üîç Checking database status...');
            
            // Create a simple PHP script call to check the current status
            fetch('check_referral_status.php?id=' + referralId)
            .then(response => response.text())
            .then(text => {
                log('üìã Current database status: ' + text);
            })
            .catch(error => {
                log('‚ö†Ô∏è Could not check database status: ' + error.message);
            });
        }
    </script>
</body>
</html>